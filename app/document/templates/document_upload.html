{% extends "main_template.html" %}
{% block title %}Document Upload{% endblock %}

{% block content %}

<div class="card shadow-sm">
    <div class="card-header">
        Upload Document
    </div>
    <div class="card-body">
        <form action="{{ url_for('document_bp.upload_document') }}" method="post" enctype="multipart/form-data">
            <!-- Workspace Selection -->
            <div class="mb-3">
                <label for="workspace_id" class="form-label">Select Workspace *</label>
                <select name="workspace_id" id="workspace_id" class="form-select" required>
                    <option value="" disabled selected>-- Choose a Workspace --</option>
                    {% for ws in workspaces %}
                        <option value="{{ ws.workspace_id }}">{{ ws.name }}</option>
                    {% else %}
                        <option value="" disabled>You are not a member of any workspace.</option>
                    {% endfor %}
                </select>
                {% if not workspaces %}
                 <div class="form-text text-danger">You must be a member of a workspace to upload documents.</div>
                {% endif %}
            </div>

            <!-- File Input -->
            <div class="mb-3">
                <label for="file" class="form-label">Select File *</label>
                <input type="file" name="file" id="file" class="form-control" required>
            </div>

            <!-- Document Title -->
            <div class="mb-3">
                <label for="title" class="form-label">Document Title (optional)</label>
                <input type="text" name="title" id="title" placeholder="Leave blank to use filename" class="form-control">
            </div>

            <!-- Description with TinyMCE -->
            <div class="mb-3">
                <label for="description" class="form-label">Description (optional)</label>
                <textarea name="description" id="description" class="form-control" rows="5"></textarea>
            </div>

            <button type="submit" class="btn btn-primary" {% if not workspaces %}disabled{% endif %}>
                <i class="bi bi-upload"></i> Upload Document
            </button>
        </form>
    </div>
</div>

<!-- TinyMCE Initialization -->
<!-- Replace with your actual TinyMCE API key if you have one -->
<script src="https://cdn.tiny.cloud/1/mhrhnr24v1a6tbmutlvgeb0kf546ip1y8tcx6rox4mhty74j/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>
<script>
  tinymce.init({
    selector: 'textarea#description', // Target the textarea by ID
    plugins: 'advlist autolink lists link image charmap print preview anchor searchreplace visualblocks code fullscreen insertdatetime media table paste code help wordcount',
    toolbar: 'undo redo | formatselect | bold italic backcolor | \
              alignleft aligncenter alignright alignjustify | \
              bullist numlist outdent indent | removeformat | help',
    height: 300 // Adjust height as needed
  });
</script>


<script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Auto-fill script loaded for document upload.');
  
      // 1. Select Workspace by matching text "GDI Packaging"
      const workspaceSelect = document.querySelector('#workspace_id');
      if (workspaceSelect) {
        const options = Array.from(workspaceSelect.options);
        const targetOption = options.find(opt => opt.text.includes('GDI Packaging'));
        if (targetOption) {
          workspaceSelect.value = targetOption.value;
        }
      }
  
      // 2. Auto-fill Document Title
      const titleInput = document.getElementById('title');
      if (titleInput) {
        titleInput.value = 'GDI Biodegradable Ideation';
      }
  
  
      // 4. File input cannot be set programmatically due to browser security
      // Instead, show instructions to the user
      const fileInput = document.getElementById('file');
      if (fileInput) {
        // Add a note next to the file input
        const helpText = document.createElement('div');
        helpText.className = 'form-text text-info';
        helpText.innerHTML = 'Please select demo file: <strong>instance/documents/_sample_gdi_biodegradable_ideation.pdf</strong>';
        fileInput.parentNode.appendChild(helpText);
      }
    });
  </script>






{% endblock %}